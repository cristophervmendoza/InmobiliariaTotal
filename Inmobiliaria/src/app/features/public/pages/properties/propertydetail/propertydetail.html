<div class="detalle">
  <div class="container">
    <button class="backButton" (click)="backToList()">
      <i-lucide name="arrow-right" [attr.style]="'transform: rotate(180deg)'" [size]="18"></i-lucide>
      Volver a propiedades
    </button>

    <div class="loading" *ngIf="isLoading">
      <div class="spinner"></div>
      <p>Cargando detalle...</p>
    </div>

    <div class="notFound" *ngIf="!isLoading && !property">
      <h2>No se encontró la propiedad</h2>
      <p>Puede que el enlace esté desactualizado.</p>
      <button class="backHomeButton" (click)="backToList()">Volver</button>
    </div>

    <ng-container *ngIf="!isLoading && property as p">
      <!-- Galería -->
      <section class="gallery">
        <div class="mainImage">
          <img [src]="p.images[currentImage]" [alt]="p.title" />
          <button class="navButton navButtonPrev" (click)="prevImage()">
            <i-lucide name="arrow-right" [attr.style]="'transform: rotate(180deg)'" [size]="20"></i-lucide>
          </button>
          <button class="navButton navButtonNext" (click)="nextImage()">
            <i-lucide name="arrow-right" [size]="20"></i-lucide>
          </button>
          <div class="imageCounter">{{ currentImage + 1 }} / {{ totalImages }}</div>

          <div class="imageActions">
            <button class="iconButton"><i-lucide name="heart" [size]="18"></i-lucide></button>
            <button class="iconButton"><i-lucide name="maximize" [size]="18"></i-lucide></button>
          </div>
        </div>

        <div class="thumbnails">
          <button *ngFor="let img of p.images; let i = index"
                  class="thumbnail"
                  [class.thumbnailActive]="i === currentImage"
                  (click)="selectImage(i)">
            <img [src]="img" [alt]="'Miniatura ' + (i + 1)" />
          </button>
        </div>
      </section>

      <!-- Contenido principal -->
      <section class="content">
        <div class="mainContent">
          <!-- Header -->
          <div class="header">
            <div>
              <div class="badges">
                <span class="typeBadge">{{ p.type | titlecase }}</span>
                <span class="statusBadge">{{ p.status }}</span>
              </div>
              <h1 class="title">{{ p.title }}</h1>
              <p class="location">
                <i-lucide name="map-pin" [size]="16"></i-lucide> {{ p.location }}
              </p>
            </div>
            <div class="price">{{ formatPrice(p.price, p.currency) }}</div>
          </div>

          <!-- Características principales -->
          <div class="mainFeatures">
            <div class="feature">
              <i-lucide name="bed" [size]="22"></i-lucide>
              <div>
                <div class="featureValue">{{ p.bedrooms }}</div>
                <div class="featureLabel">Habitaciones</div>
              </div>
            </div>
            <div class="feature">
              <i-lucide name="bath" [size]="22"></i-lucide>
              <div>
                <div class="featureValue">{{ p.bathrooms }}</div>
                <div class="featureLabel">Baños</div>
              </div>
            </div>
            <div class="feature">
              <i-lucide name="maximize" [size]="22"></i-lucide>
              <div>
                <div class="featureValue">{{ p.area }} m²</div>
                <div class="featureLabel">Área</div>
              </div>
            </div>
            <div class="feature">
              <i-lucide name="home" [size]="22"></i-lucide>
              <div>
                <div class="featureValue">{{ p.type | titlecase }}</div>
                <div class="featureLabel">Tipo</div>
              </div>
            </div>
          </div>

          <!-- Descripción -->
          <div class="section">
            <h3 class="sectionTitle">
              <i-lucide name="file-text" [size]="18"></i-lucide> Descripción
            </h3>
            <p class="description">{{ p.description }}</p>
          </div>

          <!-- Lista de características -->
          <div class="section">
            <h3 class="sectionTitle">
              <i-lucide name="check-circle" [size]="18"></i-lucide> Características
            </h3>
            <div class="featuresList">
              <div class="featureItem" *ngFor="let f of p.features">
                <i-lucide name="check" [size]="16"></i-lucide> {{ f }}
              </div>
            </div>
          </div>

          <!-- Amenidades -->
          <div class="section">
            <h3 class="sectionTitle">
              <i-lucide name="award" [size]="18"></i-lucide> Amenidades
            </h3>
            <div class="amenitiesList">
              <div class="amenityItem" [class.amenityActive]="a.active" *ngFor="let a of p.amenities">
                <i-lucide [name]="a.active ? 'check' : 'x'" [size]="16"></i-lucide>
                {{ a.label }}
              </div>
            </div>
          </div>
        </div>

        <!-- Sidebar agente -->
        <aside class="sidebar">
          <div class="contactCard">
            <h4 class="contactTitle">Contacta al Agente</h4>
            <div class="agentInfo">
              <div class="agentAvatar">{{ p.agent.name[0] }}</div>
              <div>
                <div class="agentName">{{ p.agent.name }}</div>
                <div class="agentRole">{{ p.agent.role }}</div>
              </div>
            </div>

            <div class="contactButtons">
              <a class="contactButton" [href]="'tel:' + p.agent.phone">
                <i-lucide name="phone" [size]="16"></i-lucide> Llamar
              </a>
              <a class="contactButton" [href]="'mailto:' + p.agent.email">
                <i-lucide name="mail" [size]="16"></i-lucide> Email
              </a>
            </div>

            <button class="appointmentButton">
              <i-lucide name="calendar" [size]="18"></i-lucide>
              Agendar visita
            </button>

            <div class="contactForm">
              <textarea class="textarea" placeholder="Escribe tu mensaje para el agente..."></textarea>
              <button class="submitButton">Enviar mensaje</button>
            </div>
          </div>
        </aside>
      </section>
    </ng-container>
  </div>
</div>
