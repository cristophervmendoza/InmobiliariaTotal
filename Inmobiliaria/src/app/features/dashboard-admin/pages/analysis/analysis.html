<div class="container">
  <!-- Header -->
  <div class="pageHeader">
    <div>
      <h1 class="pageTitle">Análisis de Inmuebles</h1>
      <p class="pageSubtitle">Revisa, filtra y exporta el estado de las propiedades ofrecidas</p>
    </div>

    <button class="botonExportar"
            [disabled]="exportando || inmueblesFiltrados.length === 0"
            (click)="handleExportar()">
      <span-lucide *ngIf="exportando" name="loader-2" class="iconoRotando" size="20" strokeWidth="2"></span-lucide>
      <span-lucide *ngIf="!exportando" name="file-down" size="20" strokeWidth="2"></span-lucide>
      <span>{{ exportando ? 'Exportando...' : 'Exportar a Excel' }}</span>
    </button>
  </div>

  <!-- Tarjetas estadísticas -->
  <div class="estadisticasGrid">
    <div class="tarjeta" *ngFor="let stat of estadisticas">
      <div class="contenido">
        <div class="textos">
          <p class="titulo">{{ stat.titulo }}</p>
          <h2 class="valor">{{ stat.valor }}</h2>
        </div>
        <div class="iconoContainer" [ngStyle]="{ 'background-color': stat.color }">
          <span-lucide [name]="stat.icon" size="24" strokeWidth="2.5"></span-lucide>
        </div>
      </div>
    </div>
  </div>

  <!-- Selector de vista -->
  <div class="selector">
    <button *ngFor="let tipo of tipos"
            (click)="setTipoActivo(tipo)"
            [class.opcionActiva]="tipoActivo === tipo"
            class="opcion">
      <span-lucide [name]="
          tipo === 'pendientes' ? 'loader-2' :
          tipo === 'aprobados' ? 'check-circle-2' :
          tipo === 'rechazados' ? 'x-circle' : 'building-2'"
                   size="20"
                   [attr.strokeWidth]="tipoActivo === tipo ? 2.5 : 2"
                   class="icono">
      </span-lucide>
      <span class="label">
        {{
 tipo === 'pendientes' ? 'Pendientes'
          : tipo === 'aprobados' ? 'Aprobados'
          : tipo === 'rechazados' ? 'Rechazados' : 'Todos'
        }}
      </span>
    </button>
  </div>

  <!-- Filtros rápidos -->
  <div class="selector" style="margin-bottom: 16px;">
    <input type="text"
           placeholder="Buscar por propietario o dirección..."
           [(ngModel)]="filtroTexto"
           class="opcion"
           style="justify-content:flex-start;background:#fff;border:1px solid #f1f5f9;" />

    <select [(ngModel)]="filtroTipo" class="opcion" style="background:#fff;border:1px solid #f1f5f9;">
      <option value="Todos">Todos los tipos</option>
      <option value="Casa">Casa</option>
      <option value="Departamento">Departamento</option>
      <option value="Terreno">Terreno</option>
      <option value="Otro">Otro</option>
    </select>

    <select [(ngModel)]="filtroEstado" class="opcion" style="background:#fff;border:1px solid #f1f5f9;">
      <option value="Todos">Todos los estados</option>
      <option value="Pendiente">Pendiente</option>
      <option value="Aprobado">Aprobado</option>
      <option value="Rechazado">Rechazado</option>
    </select>
  </div>

  <!-- Tabla -->
  <div class="tablaWrapper" *ngIf="inmueblesFiltrados.length; else vacioTpl">
    <table class="tabla">
      <thead>
        <tr>
          <th class="headerCell">Propietario</th>
          <th class="headerCell">Email</th>
          <th class="headerCell">Tipo</th>
          <th class="headerCell">Dirección</th>
          <th class="headerCell">Distrito</th>
          <th class="headerCell">Estado</th>
          <th class="headerCell">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr class="fila" *ngFor="let i of inmueblesFiltrados">
          <td class="celda">{{ i.nombrePropietario }}</td>
          <td class="celda">{{ i.email }}</td>
          <td class="celda">{{ i.propertyType }}</td>
          <td class="celda"><span class="contenidoCorto">{{ i.fullAddress }}</span></td>
          <td class="celda">{{ i.district }}</td>
          <td class="celda">
            <span [class]="estadoClase(i.estado)">{{ i.estado }}</span>
          </td>
          <td class="celda">
            <button class="opcion" style="padding:8px 10px;background:#fff;border:1px solid #e2e8f0;"
                    title="Ver detalle" (click)="abrirModal(i)">
              <span-lucide name="eye" size="18"></span-lucide>
            </button>
            <select class="opcion" style="padding:8px 10px;background:#fff;border:1px solid #e2e8f0;"
                    [ngModel]="i.estado"
                    (ngModelChange)="actualizarEstado(i.id, $event)">
              <option value="Pendiente">Pendiente</option>
              <option value="Aprobado">Aprobado</option>
              <option value="Rechazado">Rechazado</option>
            </select>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <ng-template #vacioTpl>
    <div class="contenedorVacio">
      <p class="mensajeVacio">No hay inmuebles para mostrar</p>
    </div>
  </ng-template>

  <!-- Modal -->
  <div class="overlay" *ngIf="seleccionado as sel">
    <div class="modal">
      <div class="imagenContainer">
        <img [src]="sel.image || '/placeholder.jpg'" [alt]="sel.propertyType" class="imagen" />
      </div>

      <div class="contenido" style="padding:16px;flex-direction:column;gap:12px;">
        <h2 class="pageTitle" style="font-size:20px;margin:0;">Descripción del Inmueble</h2>
        <span class="badge"
              [ngClass]="{
                'aprobado': sel.estado === 'Aprobado',
                'rechazado': sel.estado === 'Rechazado',
                'pendiente': sel.estado === 'Pendiente'
              }">
          {{ sel.estado }}
        </span>

        <div class="descripcionBox" style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:10px;padding:12px;">
          <p style="margin:0;color:#0f172a;">{{ sel.description }}</p>
        </div>

        <div>
          <h3 class="titulo" style="text-transform:none;">Detalles del Inmueble</h3>
          <div class="detallesGrid" style="display:grid;grid-template-columns:1fr;gap:6px;">
            <p class="celda"><strong>Tipo:</strong> {{ sel.propertyType }}</p>
            <p class="celda"><strong>Dirección:</strong> {{ sel.fullAddress }}</p>
            <p class="celda"><strong>Distrito:</strong> {{ sel.district }}</p>
          </div>
        </div>

        <div>
          <h3 class="titulo" style="text-transform:none;">Propietario</h3>
          <p class="celda"><strong>Nombre:</strong> {{ sel.nombrePropietario }}</p>
          <p class="celda"><strong>Correo:</strong> {{ sel.email }}</p>
        </div>
      </div>

      <div class="footer" style="grid-column:1/-1;padding:12px;display:flex;justify-content:flex-end;background:#f8fafc;">
        <button (click)="cerrarModal()" class="opcion" style="background:#fff;border:1px solid #e2e8f0;">✖ Cerrar</button>
      </div>
    </div>
  </div>
</div>
