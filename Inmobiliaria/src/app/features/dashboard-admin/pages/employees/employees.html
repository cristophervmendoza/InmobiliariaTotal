<div class="container">
  <!-- Header -->
  <div class="header">
    <div>
      <h1 class="title">Gestión de Empleados</h1>
      <p class="subtitle">Administra los agentes inmobiliarios de tu empresa</p>
    </div>
    <button (click)="openCreate()" class="createButton">
      <span-lucide name="plus" size="20" strokeWidth="2.5"></span-lucide>
      <span>Crear Empleado</span>
    </button>
  </div>

  <!-- Estadísticas -->
  <div class="estadisticasGrid">
    <div class="tarjeta">
      <div class="contenido">
        <div class="textos">
          <p class="titulo">Total</p>
          <h2 class="valor">{{ stats.total }}</h2>
        </div>
        <div class="iconoContainer" [ngStyle]="{ 'background-color': '#06b6d4' }">
          <span-lucide name="users" size="24" strokeWidth="2.5"></span-lucide>
        </div>
      </div>
    </div>
    <div class="tarjeta">
      <div class="contenido">
        <div class="textos">
          <p class="titulo">Inactivos</p>
          <h2 class="valor">{{ stats.pendientes }}</h2>
        </div>
        <div class="iconoContainer" [ngStyle]="{ 'background-color': '#f59e0b' }">
          <span-lucide name="clock" size="24" strokeWidth="2.5"></span-lucide>
        </div>
      </div>
    </div>
    <div class="tarjeta">
      <div class="contenido">
        <div class="textos">
          <p class="titulo">Registrados</p>
          <h2 class="valor">{{ stats.revisadas }}</h2>
        </div>
        <div class="iconoContainer" [ngStyle]="{ 'background-color': '#3b82f6' }">
          <span-lucide name="file-text" size="24" strokeWidth="2.5"></span-lucide>
        </div>
      </div>
    </div>
    <div class="tarjeta">
      <div class="contenido">
        <div class="textos">
          <p class="titulo">Activos</p>
          <h2 class="valor">{{ stats.aprobadas }}</h2>
        </div>
        <div class="iconoContainer" [ngStyle]="{ 'background-color': '#10b981' }">
          <span-lucide name="check-circle" size="24" strokeWidth="2.5"></span-lucide>
        </div>
      </div>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filterContainer">
    <div class="searchWrapper">
      <span-lucide name="search" size="18" strokeWidth="2.5" class="searchIcon"></span-lucide>
      <input type="text"
             placeholder="Buscar por nombre o email..."
             [value]="searchTerm"
             (input)="onSearchChange($event)"
             class="searchInput" />
    </div>

    <select [ngModel]="statusFilter"
            (ngModelChange)="onStatusChange($event)"
            class="statusSelect"
            name="statusFilter">
      <option value="todos">Todos los estados</option>
      <option value="activo">Activos</option>
      <option value="inactivo">Inactivos</option>
    </select>
  </div>

  <!-- Listado de empleados -->
  <div class="tableContainer" *ngIf="filteredEmpleados.length > 0; else emptyState">
    <table class="table">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>DNI</th>
          <th>Email</th>
          <th>Teléfono</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let empleado of filteredEmpleados">
          <td>
            <span class="name">{{ empleado.nombre }}</span>
          </td>
          <td>{{ empleado.dni }}</td>
          <td>{{ empleado.email }}</td>
          <td>{{ empleado.telefono }}</td>
          <td>
            <span class="badge" [ngClass]="empleado.estado === 'activo' ? 'badgeActive' : 'badgeInactive'">
              {{ empleado.estado === 'activo' ? 'Activo' : 'Inactivo' }}
            </span>
          </td>
          <td>
            <div class="actions">
              <button (click)="handleView(empleado)"
                      class="actionButton"
                      title="Ver detalles"
                      aria-label="Ver detalles">
                <span-lucide name="eye" size="18" strokeWidth="2.5"></span-lucide>
              </button>

              <button (click)="handleEdit(empleado)"
                      class="actionButton"
                      title="Editar"
                      aria-label="Editar">
                <span-lucide name="edit-2" size="18" strokeWidth="2.5"></span-lucide>
              </button>

              <button (click)="toggleEstado(empleado.idAgenteInmobiliario)"
                      class="actionButton"
                      [class.toggleActive]="empleado.estado === 'activo'"
                      [class.toggleInactive]="empleado.estado === 'inactivo'"
                      [title]="empleado.estado === 'activo' ? 'Desactivar' : 'Activar'"
                      [attr.aria-label]="empleado.estado === 'activo' ? 'Desactivar' : 'Activar'">
                <span-lucide [name]="empleado.estado === 'activo' ? 'toggle-right' : 'toggle-left'"
                             size="18"
                             strokeWidth="2.5"></span-lucide>
              </button>

              <button (click)="handleDelete(empleado.idAgenteInmobiliario)"
                      class="actionButton deleteButton"
                      title="Eliminar"
                      aria-label="Eliminar">
                <span-lucide name="trash-2" size="18" strokeWidth="2.5"></span-lucide>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Empty state -->
  <ng-template #emptyState>
    <div class="emptyState">
      <span-lucide name="users-round" size="48" strokeWidth="1.5" style="color: #94a3b8; margin-bottom: 12px;"></span-lucide>
      <p>No hay empleados registrados</p>
      <button (click)="openCreate()" class="emptyStateButton">
        <span-lucide name="plus" size="18" strokeWidth="2.5"></span-lucide>
        <span>Crear primer empleado</span>
      </button>
    </div>
  </ng-template>

  <!-- Modal Formulario -->
  <div class="modalOverlay" *ngIf="showForm" (click)="closeForm()">
    <div class="modalContent" (click)="$event.stopPropagation()">
      <div class="modalHeader">
        <h2>{{ editingEmployee ? 'Editar Empleado' : 'Crear Nuevo Empleado' }}</h2>
        <button (click)="closeForm()" class="closeButton" aria-label="Cerrar">
          <span-lucide name="x" size="24" strokeWidth="2.5"></span-lucide>
        </button>
      </div>

      <form (ngSubmit)="handleSave()" class="form" autocomplete="off">
        <div class="formGrid">
          <!-- Nombre Completo -->
          <div class="formGroup fullWidth">
            <label for="nombre">Nombre Completo *</label>
            <input type="text"
                   id="nombre"
                   name="nombre"
                   [ngModel]="formData.nombre"
                   (ngModelChange)="handleInputChange('nombre', $event)"
                   [class.inputError]="!!errors['nombre']"
                   placeholder="Ej: Carlos Rodríguez" />
            <span class="error" *ngIf="errors['nombre']">{{ errors['nombre'] }}</span>
          </div>

          <!-- DNI -->
          <div class="formGroup">
            <label for="dni">DNI *</label>
            <input type="text"
                   id="dni"
                   name="dni"
                   [ngModel]="formData.dni"
                   (ngModelChange)="handleInputChange('dni', $event)"
                   [class.inputError]="!!errors['dni']"
                   [disabled]="!!editingEmployee"
                   placeholder="12345678"
                   maxlength="8" />
            <span class="error" *ngIf="errors['dni']">{{ errors['dni'] }}</span>
          </div>

          <!-- Email -->
          <div class="formGroup">
            <label for="email">Email *</label>
            <input type="email"
                   id="email"
                   name="email"
                   [ngModel]="formData.email"
                   (ngModelChange)="handleInputChange('email', $event)"
                   [class.inputError]="!!errors['email']"
                   placeholder="correo@idealhome.pe" />
            <span class="error" *ngIf="errors['email']">{{ errors['email'] }}</span>
          </div>

          <!-- Teléfono -->
          <div class="formGroup">
            <label for="telefono">Teléfono *</label>
            <input type="tel"
                   id="telefono"
                   name="telefono"
                   [ngModel]="formData.telefono"
                   (ngModelChange)="handleInputChange('telefono', $event)"
                   [class.inputError]="!!errors['telefono']"
                   placeholder="987654321"
                   maxlength="9" />
            <span class="error" *ngIf="errors['telefono']">{{ errors['telefono'] }}</span>
          </div>

          <!-- Contraseña (solo al crear) -->
          <div class="formGroup" *ngIf="!editingEmployee">
            <label for="password">Contraseña *</label>
            <input type="password"
                   id="password"
                   name="password"
                   [ngModel]="formData.password"
                   (ngModelChange)="handleInputChange('password', $event)"
                   [class.inputError]="!!errors['password']"
                   placeholder="Mínimo 8 caracteres" />
            <span class="error" *ngIf="errors['password']">{{ errors['password'] }}</span>
          </div>

          <!-- Estado -->
          <div class="formGroup">
            <label for="idEstadoUsuario">Estado *</label>
            <select id="idEstadoUsuario"
                    name="idEstadoUsuario"
                    [ngModel]="formData.idEstadoUsuario"
                    (ngModelChange)="handleInputChange('idEstadoUsuario', $event)">
              <option [value]="1">Activo</option>
              <option [value]="2">Inactivo</option>
            </select>
          </div>
        </div>

        <div class="formActions">
          <button type="button" (click)="closeForm()" class="cancelButton">Cancelar</button>
          <button type="submit" class="submitButton" [disabled]="isLoading">
            <span-lucide [name]="editingEmployee ? 'save' : 'plus'" size="18" strokeWidth="2.5"></span-lucide>
            <span>{{ editingEmployee ? 'Actualizar' : 'Crear' }} Empleado</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Detalles -->
  <div class="modalOverlay" *ngIf="showModal" (click)="showModal = false; selectedEmployee = null">
    <div class="modalContent" (click)="$event.stopPropagation()">
      <div class="modalHeader">
        <h2>Detalles del Empleado</h2>
        <button (click)="showModal = false; selectedEmployee = null" class="closeButton" aria-label="Cerrar">
          <span-lucide name="x" size="24" strokeWidth="2.5"></span-lucide>
        </button>
      </div>

      <div class="modalBody" *ngIf="selectedEmployee as empleado">
        <div class="profileSection">
          <h3 class="employeeName">{{ empleado.nombre }}</h3>
          <span class="badge" [ngClass]="empleado.estado === 'activo' ? 'badgeActive' : 'badgeInactive'">
            {{ empleado.estado === 'activo' ? 'Activo' : 'Inactivo' }}
          </span>
        </div>

        <div class="infoGrid">
          <div class="infoItem">
            <span-lucide name="file-text" size="18" strokeWidth="2.5"></span-lucide>
            <div>
              <p class="label">DNI</p>
              <p class="value">{{ empleado.dni }}</p>
            </div>
          </div>

          <div class="infoItem">
            <span-lucide name="mail" size="18" strokeWidth="2.5"></span-lucide>
            <div>
              <p class="label">Email</p>
              <p class="value">{{ empleado.email }}</p>
            </div>
          </div>

          <div class="infoItem">
            <span-lucide name="phone" size="18" strokeWidth="2.5"></span-lucide>
            <div>
              <p class="label">Teléfono</p>
              <p class="value">{{ empleado.telefono }}</p>
            </div>
          </div>

          <div class="infoItem">
            <span-lucide name="calendar" size="18" strokeWidth="2.5"></span-lucide>
            <div>
              <p class="label">ID Agente</p>
              <p class="value">{{ empleado.idAgenteInmobiliario }}</p>
            </div>
          </div>
        </div>
      </div>

      <div class="modalFooter">
        <button (click)="handleEditFromModal()" class="editFromModalButton">
          <span-lucide name="edit-2" size="18" strokeWidth="2.5"></span-lucide>
          <span>Editar Empleado</span>
        </button>
        <button (click)="showModal = false; selectedEmployee = null" class="closeModalButton">
          Cerrar
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de Confirmación -->
  <div class="modalOverlay" *ngIf="showConfirmModal" (click)="closeConfirmModal()">
    <div class="confirmModal" (click)="$event.stopPropagation()">
      <div class="confirmHeader">
        <div class="confirmIcon">
          <span-lucide name="alert-triangle" size="32" strokeWidth="2.5"></span-lucide>
        </div>
        <h2 class="confirmTitle">Confirmar Acción</h2>
      </div>

      <div class="confirmBody">
        <p class="confirmMessage">{{ confirmMessage }}</p>
      </div>

      <div class="confirmFooter">
        <button (click)="closeConfirmModal()" class="confirmCancelButton">
          Cancelar
        </button>
        <button (click)="confirmActionHandler()"
                class="confirmAcceptButton"
                [class.deleteButton]="confirmAction === 'delete'"
                [disabled]="isLoading">
          {{ confirmAction === 'delete' ? 'Eliminar' : 'Confirmar' }}
        </button>
      </div>
    </div>
  </div>
</div>
